{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>마이워커</title>
    <link rel="icon" href="{% static 'img/icon.svg' %}" type="image/x-icon" />
    <link rel="stylesheet" href="{% static 'css/expert_search.css' %}" />
    <link rel="stylesheet" href="{% static 'components/footer.css' %}" />
    <link rel="stylesheet" href="{% static 'components/navbar.css' %}" />
     <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

     <style>
      .wrapper {
        min-height: 465px;
        display: flex;
        flex-direction: column;
      }

      .none {
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        height: 380px;
      }
     </style>
</head>
<body>
{% include 'components/navbar.html' %}

<div class="wrapper">
  <form id="expert-filter-form" method="GET">
    <div class="Top">
      <div class="SearchBox">
        <img src="{% static 'img/search.svg' %}" alt="search" width="26px" />
        <input class="Search" type="text" name="keyword" value="{{ keyword }}" placeholder="전문가명, 한줄소개, 키워드 검색">
      </div>
      <button type="button" class="SearchCategory">
        <a href="{% url 'category:category_list' %}">카테고리로 찾기 ></a>
      </button>
    </div>

    <div class="ResultFilter">
      <div class="ResultText">
        <span class="BlueText">{{ keyword }}</span> 키워드에 해당하는 
        <span class="BlueText">{{ total_count }}</span> 명의 전문가가 있습니다.
      </div>

      <div class="FilterButtons">
        <button type="button" class="Region">지역 <img src="{% static 'img/filter.svg' %}" alt="filter" width="12.6px" /></button>
        <button type="button" class="Work">경력 <img src="{% static 'img/filter.svg' %}" alt="filter" width="12.6px" /></button>
        <button type="button" class="Badge">인증배지 <img src="{% static 'img/filter.svg' %}" alt="filter" width="12.6px" /></button>
        <button type="submit" class="FilterSearch">🔍</button>
      </div>

      <div class="Regioncheck" id="RegionList">
        <div class="RegionTop">
          <label class="custom-checkbox">
            <input class="checkbox" type="checkbox" name="seoul_all" value="true" {% if seoul_all %}checked{% endif %}>
            <span class="checkmark"></span>
            <span class="checkbox-label">서울시 전체</span>
          </label>
        </div>
        <div class="RegionLine"></div>
        <div class="RegionGrid">
          {% for region in region_list %}
          <label class="custom-checkbox">
            <input class="checkbox" type="checkbox" name="region" value="{{ region }}" {% if region in selected_region %}checked{% endif %}>
            <span class="checkmark"></span>
            <span class="checkbox-label">{{ region }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="WorkCheck">
        <div class="EWrapper">
          <label class="custom-checkbox">
            <input type="checkbox" name="experience" value="none" {% if 'none' in selected_experience %}checked{% endif %}>
            <span class="checkmark"></span>
            <span class="checkbox-label">경력 무관</span>
          </label>
          <div class="line"></div>
          {% for val, label in experience_options %}
          <label class="custom-checkbox">
            <input type="checkbox" name="experience" value="{{ val }}" {% if val in selected_experience %}checked{% endif %}>
            <span class="checkmark"></span>
            <span class="checkbox-label">{{ label }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="BadgeCheck" id="BadgeList">
        <div class="VWrapper">
          <label class="custom-checkbox">
            <input type="checkbox" name="badge_all" id="badge_all">
            <span class="checkmark"></span>
            <span class="checkbox-label">전체</span>
          </label>
          <div class="line"></div>
          <label class="custom-checkbox">
            <input type="checkbox" name="badge" value="true" id="badge_true" {% if badge %}checked{% endif %}>
            <span class="checkmark"></span>
            <span class="checkbox-label">인증배지 보유</span>
          </label>
        </div>
      </div>
    </div>
  </form>
</div>

  <div class="line"></div>
<div class="wrapper">
  {% if experts %}
  <div class="ExpertBoxes">
    {% for expert in experts %}
      {% if forloop.counter <= 5 or show_all %}
        <div class="ExpertBox">
            <a href="{% url 'experts:expert_detail' expert.user.id %}" class="Nickname">
          <img class="img" src="{% static 'img/profile.svg' %}" alt="profile" />
          <div class="ExpertInfo">
            <div class="NickNameDiv">
                {{ expert.user.nickname }}
              </a>
              {% if expert.badge == 'VERIFIED' %}
                <img src="{% static 'img/badgeicon.svg' %}" class="BadgeIcon" />
              {% endif %}
            </div>
            <div class="Introduce">{{ expert.bio|default:"한줄소개 미등록" }}</div>
            <div class="Description">{{ expert.description|truncatechars:100 }}</div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
{% elif keyword or selected_region or selected_experience or badge %}
  <p class="none">검색 결과가 없습니다.</p>
{% endif %}
    <button type="submit" class="ShowAllBtn">
        <span class="BlueText">{{ total_count }}</span>개의 결과 전체보기
    </button>

  </div>

  {% comment %} {% if not keyword and not selected_region and not selected_experience and not badge %} {% endcomment %}

  {% include "components/footer.html" %}
  <script src="{% static 'components/footer.js' %}"></script>
  <script src="{% static 'components/navbar.js' %}"></script>
  <script>

    const toggleModal = (btnSelector, modalSelector, displayType = "block") => {
    const btn = document.querySelector(btnSelector);
    const modal = document.querySelector(modalSelector);

      btn.addEventListener("click", () => {
        if (!modal) return;
        const isOpen = modal.style.display === displayType;
        // 전부 닫고 선택한 것만 열기
        document.querySelectorAll(".Regioncheck, .WorkCheck, .BadgeCheck").forEach(el => el.style.display = "none");
        modal.style.display = isOpen ? "none" : displayType;
      });
    };

  toggleModal(".Region", ".Regioncheck");
  toggleModal(".Work", ".WorkCheck", "flex");
  toggleModal(".Badge", ".BadgeCheck");

  document.addEventListener("DOMContentLoaded", function () {
    const badgeAll = document.getElementById("badge_all");
    const badgeTrue = document.getElementById("badge_true");
    const form = document.getElementById("expert-filter-form");

    if (badgeAll && badgeTrue) {
      badgeAll.addEventListener("change", function () {
        if (badgeAll.checked) {
          badgeTrue.checked = false;
        }
        
      });

      badgeTrue.addEventListener("change", function () {
        if (badgeTrue.checked) {
          badgeAll.checked = false;
        }
      });
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    // 지역 필터: 개별 체크 시 "서울시 전체" 해제
    const regionAllCheckbox = document.querySelector('input[name="region"]:not([value])');
    const seoulAllCheckbox = document.querySelector('input[name="seoul_all"]');
    const regionCheckboxes = document.querySelectorAll('input[name="region"][value]');

    if (seoulAllCheckbox) {
      seoulAllCheckbox.addEventListener("change", () => {
        if (seoulAllCheckbox.checked) {
          regionCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

    regionCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        if (checkbox.checked && regionAllCheckbox.checked) {
          regionAllCheckbox.checked = false;
        }
      });
    });

    // 경력 필터: "경력 무관" 체크 시 나머지 해제, 나머지 중 하나 체크 시 "경력 무관" 해제
    const experienceNoneCheckbox = document.querySelector('input[name="experience"]:not([value])'); // 경력 무관
    const experienceDetailCheckboxes = document.querySelectorAll('input[name="experience"][value]');

    if (experienceNoneCheckbox) {
      // "경력 무관" 클릭 시 나머지 해제
      experienceNoneCheckbox.addEventListener("change", () => {
        if (experienceNoneCheckbox.checked) {
          experienceDetailCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

    experienceDetailCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        if (checkbox.checked && experienceNoneCheckbox.checked) {
          experienceNoneCheckbox.checked = false;
        }
      });
    });

    // "서울시 전체" 클릭 시 나머지 지역 체크 해제
    if (regionAllCheckbox) {
      regionAllCheckbox.addEventListener("change", () => {
        if (regionAllCheckbox.checked) {
          regionCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

   
  });
  </script>

</body>
</html>
