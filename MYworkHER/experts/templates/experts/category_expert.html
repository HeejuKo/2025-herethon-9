{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ë¬¸ê°€ ë¦¬ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="{% static 'css/category.css' %}"/>

  <link rel="stylesheet" href="{% static 'css/category_expert.css' %}"/>
  <link rel="stylesheet" href="{% static 'components/footer.css' %}" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'components/navbar.css' %}"/>

</head>
<body>
  {% include 'components/navbar.html' %}

<div class="wrapper">
  <div id="categoryContainer" style=" margin-top: 0; pointer-events: none; cursor: default;"></div>
  <div class="line" style="margin-bottom: 29px;"></div>

  <!-- Djangoê°€ ë Œë”ë§í•œ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ë“¤ -->
  {% for key, cat in categories.items %}
    <div id="sub-{{ key }}" class="subcategory-list" style="display: none;">
  {% for sub in cat.subcategories %}
    {% if forloop.first or forloop.counter0|divisibleby:2 %}
      <div style="display: none;" class="subcategory-row">
    {% endif %}

        <div style="display: none;" class="subcategory-item">
          <a href="{% url 'experts:expert_category' %}?category={{ key }}&subcategory={{ sub.name }}">
            <span class="subName"> {{ sub.name }}</span> <span class="subCount">ì „ë¬¸ê°€ {{ sub.count }}ëª…</span>
          </a>
        </div>

    {% if forloop.last or forloop.counter|divisibleby:2 %}
      </div>
    {% endif %}
  {% endfor %}
  </div>
  {% endfor %}

<div class="TextWrapper">
  <div class="ResultText">
    <span class="BlueText">{{ category_label }}</span>
    <span class="BlackText">></span>
    <span class="BlueText">{{ subcategory_label }}</span>
    <span class="BlackText"> ì— í•´ë‹¹í•˜ëŠ” </span>
    <span class="BlueText">{{ total_count }}</span>
    <span class="BlackText">ëª…ì˜ ì „ë¬¸ê°€ê°€ ìˆìŠµë‹ˆë‹¤.</span>
  </div>

  <div class="ResultFilter">
  <div class="ResultText"></div>

    <form id="expert-filter-form" method="get">

    <input type="hidden" name="category" value="{{ request.GET.category }}">
    <input type="hidden" name="subcategory" value="{{ request.GET.subcategory }}">

  <button type="button" class="Region">
    ì§€ì—­
    <img
      src="{% static 'img/filter.svg' %}"
      alt="filter"
      width="12.6px"
    />
    </button>
    <div class="Regioncheck" id="RegionList">
 <!-- ì§€ì—­ í•„í„° -->
    <div class="reginWrapper">
      <label class="custom-checkbox">
        <input type="checkbox" name="seoul_all" value="true" {% if seoul_all %}checked{% endif %}>
        <span class="checkmark"></span>
        <span class="checkbox-label">ì„œìš¸ì‹œ ì „ì²´</span>
      </label>
      <div class="line"></div>
<div class="reginLabelWrapper">
      {% for region in region_list %}
        {% if forloop.first or forloop.counter0|divisibleby:5 %}
          <div class="EachFive">
        {% endif %}

            <label class="custom-checkbox">
              <input type="checkbox" name="region" value="{{ region }}" {% if region in selected_region %}checked{% endif %}>
              <span class="checkmark"></span>
              <span class="checkbox-label">{{ region }}</span>
            </label>

        {% if forloop.last or forloop.counter|divisibleby:5 %}
          </div>
        {% endif %}
      {% endfor %}
      </div>
    </div>

    </div>

    <button type="button" class="Work">
      ê²½ë ¥
      <img
        src="{% static 'img/filter.svg' %}"
        alt="filter"
        width="12.6px"
      />
      </button>
      <div class="WorkCheck">
 <!-- ê²½ë ¥ í•„í„° -->
    <div class="EWrapper">
      
      <label class="custom-checkbox">
        <input type="checkbox" name="experience"  >
        <span class="checkmark"></span>
        <span class="checkbox-label">ê²½ë ¥ ë¬´ê´€</span>
      </label>
      <div class="line"></div>
      <label class="custom-checkbox">
        <input type="checkbox" name="experience" value="0" {% if '0' in selected_experience %}checked{% endif %}>
        <span class="checkmark"></span>
        <span class="checkbox-label">1ë…„ ë¯¸ë§Œ</span>
      </label>
      <label class="custom-checkbox">
        <input type="checkbox" name="experience" value="1" {% if '1' in selected_experience %}checked{% endif %}>
        <span class="checkmark"></span>
        <span class="checkbox-label">1ë…„~3ë…„</span>
      </label>
      <label class="custom-checkbox">
        <input type="checkbox" name="experience" value="3" {% if '3' in selected_experience %}checked{% endif %}>
        <span class="checkmark"></span>
        <span class="checkbox-label">3ë…„~5ë…„</span>
      </label>
      <label class="custom-checkbox">
        <input type="checkbox" name="experience" value="5" {% if '5' in selected_experience %}checked{% endif %}>
        <span class="checkmark"></span>
        <span class="checkbox-label">5ë…„ ì´ìƒ</span>
      </label>
    </div>

      </div>

    


        <button type="button" class="Badge">
          ì¸ì¦ë°°ì§€
          <img
            src="{% static 'img/filter.svg' %}"
            alt="filter"
            width="12.6px"
          />
          </button>
          <div class="BadgeCheck" id="BadgeList">

                        <!-- ë°°ì§€ í•„í„° -->
            <div class="VWrapper">
              <!-- ì „ì²´ ì„ íƒ: badge íŒŒë¼ë¯¸í„° ì—†ì´ -->
              <label class="custom-checkbox">
                <input type="checkbox" name="badge_all" id="badge_all" >
                <span class="checkmark"></span>
                <span  class="checkbox-label">ì „ì²´</span>
              </label>
      <div class="line"></div>

              <!-- ì¸ì¦ë°°ì§€ ë³´ìœ : badge=true -->
              <label class="custom-checkbox">
                <input type="checkbox" name="badge" value="true" id="badge_true" {% if badge %}checked{% endif %}>
                <span class="checkmark"></span>
                <span class="checkbox-label">ì¸ì¦ë°°ì§€ ë³´ìœ </span>
              </label>
            </div>
          </div>
          
          <button type="submit" class="Search"  >
          ğŸ”
      
          </button>
</div>
      </div>
    </div>


   

   

   
  </form>

  <!-- ì „ë¬¸ê°€ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
    <div class="ExpertBoxes2">
    {% for expert in experts %}
      <div class="ExpertBox">
        {% if expert.profileImage %}
        <img
          src="{{ expert.profileImage.url }}"
          alt="profile"
          width="91px"
          class="img"
        />
        {% else %}
        <img
          src="{% static 'img/basic_profile.svg' %}"
          alt="profile"
          width="91px"
          class="img"
        />
        {% endif %}

        <div class="ExpertInfo">
          <div class="NicknameDiv">
            <div class="Nickname">{{ expert.user.nickname }}</div>
            {% if expert.badge == 'VERIFIED' %}
              <img
                src="{% static 'img/badgeicon.svg' %}"
                alt="badge"
                width="33"
                class="BadgeIcon"
              >
            {% endif %}
          </div>
          <div class="Introduce">{{ expert.bio }}</div>
          <div class="Description">{{ expert.description|truncatechars:100 }}</div>
        </div>
      </div>
      {% if experts|length > 5 %}
        <button class="ShowAllBtn">
          <span class="Count">{{ total_count }}</span><span class="ShowText"> ê°œì˜ ê²°ê³¼ ì „ì²´ë³´ê¸°</span>
        </button>
      {% endif %}
    {% empty %}
      <p>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ì „ë¬¸ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
  </div>

  {% include 'components/footer.html' %}


  <script>

    const toggleModal = (btnSelector, modalSelector, displayType = "block") => {
    const btn = document.querySelector(btnSelector);
    const modal = document.querySelector(modalSelector);

    btn.addEventListener("click", () => {
      if (!modal) return;
      const isOpen = modal.style.display === displayType;
      // ì „ë¶€ ë‹«ê³  ì„ íƒí•œ ê²ƒë§Œ ì—´ê¸°
      document.querySelectorAll(".Regioncheck, .WorkCheck, .BadgeCheck").forEach(el => el.style.display = "none");
      modal.style.display = isOpen ? "none" : displayType;
    });
  };

  toggleModal(".Region", ".Regioncheck");
  toggleModal(".Work", ".WorkCheck", "flex");
  toggleModal(".Badge", ".BadgeCheck");

  document.addEventListener("DOMContentLoaded", function () {
    const badgeAll = document.getElementById("badge_all");
    const badgeTrue = document.getElementById("badge_true");
    const form = document.getElementById("expert-filter-form");

    if (badgeAll && badgeTrue) {
      badgeAll.addEventListener("change", function () {
        if (badgeAll.checked) {
          badgeTrue.checked = false;
        }
        
      });

      badgeTrue.addEventListener("change", function () {
        if (badgeTrue.checked) {
          badgeAll.checked = false;
        }
      });
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    // ì§€ì—­ í•„í„°: ê°œë³„ ì²´í¬ ì‹œ "ì„œìš¸ì‹œ ì „ì²´" í•´ì œ
    const regionAllCheckbox = document.querySelector('input[name="region"]:not([value])');
    const seoulAllCheckbox = document.querySelector('input[name="seoul_all"]');
    const regionCheckboxes = document.querySelectorAll('input[name="region"][value]');

    if (seoulAllCheckbox) {
      seoulAllCheckbox.addEventListener("change", () => {
        if (seoulAllCheckbox.checked) {
          regionCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

    regionCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        if (checkbox.checked && regionAllCheckbox.checked) {
          regionAllCheckbox.checked = false;
        }
      });
    });

    // ê²½ë ¥ í•„í„°: "ê²½ë ¥ ë¬´ê´€" ì²´í¬ ì‹œ ë‚˜ë¨¸ì§€ í•´ì œ, ë‚˜ë¨¸ì§€ ì¤‘ í•˜ë‚˜ ì²´í¬ ì‹œ "ê²½ë ¥ ë¬´ê´€" í•´ì œ
    const experienceNoneCheckbox = document.querySelector('input[name="experience"]:not([value])'); // ê²½ë ¥ ë¬´ê´€
    const experienceDetailCheckboxes = document.querySelectorAll('input[name="experience"][value]');

    if (experienceNoneCheckbox) {
      // "ê²½ë ¥ ë¬´ê´€" í´ë¦­ ì‹œ ë‚˜ë¨¸ì§€ í•´ì œ
      experienceNoneCheckbox.addEventListener("change", () => {
        if (experienceNoneCheckbox.checked) {
          experienceDetailCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

    experienceDetailCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        if (checkbox.checked && experienceNoneCheckbox.checked) {
          experienceNoneCheckbox.checked = false;
        }
      });
    });

    // "ì„œìš¸ì‹œ ì „ì²´" í´ë¦­ ì‹œ ë‚˜ë¨¸ì§€ ì§€ì—­ ì²´í¬ í•´ì œ
    if (regionAllCheckbox) {
      regionAllCheckbox.addEventListener("change", () => {
        if (regionAllCheckbox.checked) {
          regionCheckboxes.forEach(cb => cb.checked = false);
        }
      });
    }

   
  });
  </script>

  <script>
    const categoryInfo = {
      appliance: {
        imgSrc: "/static/img/main_C1.svg",
        alt: "repair",
        className: "C1"
      },
      health: {
        imgSrc: "/static/img/main_C2.svg",
        alt: "sports",
        className: "C2"
      },
      business: {
        imgSrc: "/static/img/main_C3.svg",
        alt: "consulting",
        className: "C3"
      },
      lifestyle: {
        imgSrc: "/static/img/main_C4.svg",
        alt: "life",
        className: "C4"
      }
    };

    function createCategoryBox(key) {
      const info = categoryInfo[key];
      if (!info) return;

      const wrapper = document.createElement('div');
      wrapper.className = "category-box";
      wrapper.onclick = () => toggleSub(key);
      wrapper.innerHTML = `
        <div class="Category">
          <div class="${info.className}">
            <img id="img-${key}" src="${info.imgSrc}" alt="${info.alt}" width="222.516px" />
          </div>
        </div>
      `;
      return wrapper;
    }

    const categories = ['appliance', 'health', 'business', 'lifestyle'];
    const container = document.getElementById('categoryContainer');

    categories.forEach(key => {
      const box = createCategoryBox(key);
      container.appendChild(box);
    });

    // ì¹´í…Œê³ ë¦¬ í‘œì‹œ
    const urlParams = new URLSearchParams(window.location.search);
    const selectedCategory = urlParams.get("category") || "appliance"; // ê¸°ë³¸ê°’ì€ 'appliance'
    toggleSub(selectedCategory);

    function toggleSub(key) {
      document.querySelectorAll('.subcategory-list').forEach(el => {
        el.style.display = 'none'; // ì „ë¶€ ìˆ¨ê¸°ê³ 
    });

      const target = document.getElementById('sub-' + key);
      if (target) {
        target.style.display = 'block'; // í•´ë‹¹ í‚¤ë§Œ ë³´ì´ê²Œ
      }

      categories.forEach(catKey => {
        const img = document.getElementById('img-' + catKey);
        if (img) {
          img.style.opacity = (catKey === key) ? '1' : '0.2';
        }
      });
    }
  </script>

  <script src="{% static 'components/navbar.js' %}"></script>

</body>
</html>
